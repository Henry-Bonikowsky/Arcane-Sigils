# 1.8 PvP Recreation - Paper API Research Report

## Executive Summary

This report documents findings from 35+ sources on implementing 1.8 PvP mechanics in Paper 1.21. Key discovery: **Golden apple eating speed cannot be modified at runtime on Paper 1.21.1** - the DataComponentTypes API for CONSUMABLE was added in **Paper 1.21.2+**.

---

## 1. Golden Apple Eating Speed

### The Problem
Your GoldenAppleModule isn't working because Paper 1.21.1 doesn't have the `io.papermc.paper.datacomponent` package. This API was added in Paper 1.21.2.

### Solution Options

#### Option A: Upgrade to Paper 1.21.2+ (Recommended)
Use the Data Component API:
```java
import io.papermc.paper.datacomponent.DataComponentTypes;
import io.papermc.paper.datacomponent.item.Consumable;

// Modify golden apple in player's inventory
ItemStack item = player.getInventory().getItemInMainHand();
if (item.getType() == Material.GOLDEN_APPLE) {
    Consumable original = item.getData(DataComponentTypes.CONSUMABLE);
    Consumable faster = original.toBuilder()
        .consumeSeconds(1.0f)  // 1.0s instead of 1.6s
        .build();
    item.setData(DataComponentTypes.CONSUMABLE, faster);
}
```

#### Option B: Stay on 1.21.1 - Use NMS/Reflection
Directly modify the item's NMS data using CraftBukkit internals (version-specific, may break).

#### Option C: Cancel and Re-apply
Cancel PlayerItemConsumeEvent, manually schedule consumption completion faster using BukkitScheduler.

### Default Eating Times
- All food: 32 ticks (1.6 seconds)
- Dried kelp: 16 ticks (0.8 seconds)
- Honey bottles: 40 ticks (2.0 seconds)

### Sources
- [Paper DataComponentTypes](https://jd.papermc.io/paper/1.21.4/io/papermc/paper/datacomponent/DataComponentTypes.html)
- [Paper Data Component API Docs](https://docs.papermc.io/paper/dev/data-component-api/)
- [GitHub Issue #10796 - eat_seconds bug](https://github.com/PaperMC/Paper/issues/10796)
- [Minecraft Wiki - Food](https://minecraft.wiki/w/Food)

---

## 2. Attack Cooldown Removal

### Implementation
Set `GENERIC_ATTACK_SPEED` to 1024+ to effectively disable cooldown:
```java
AttributeInstance attr = player.getAttribute(Attribute.GENERIC_ATTACK_SPEED);
attr.setBaseValue(1024.0);
```

### Known Bug
[Paper Issue #11552](https://github.com/PaperMC/Paper/issues/11552): Quick-swapping items can cause `getAttackCooldown()` to incorrectly return 1.0, bypassing cooldown checks.

### Sources
- [Paper Attribute API](https://jd.papermc.io/paper/1.21.1/org/bukkit/attribute/Attribute.html)
- [Hypixel Forums - Attack Speed](https://hypixel.net/threads/generic-attackspeed-help.401171/)
- [Minecraft Forum - Disable Cooldown](https://www.minecraftforum.net/forums/minecraft-java-edition/discussion/2997273-how-do-i-completely-remove-attack-cooldown)

---

## 3. Knockback Mechanics

### 1.8 vs 1.9 Differences
- **1.8**: Knockback based on damage amount (major factor) + distance (minor factor)
- **1.9+**: Knockback more standardized

### Formula Factors
- Base horizontal: 0.4 blocks/tick
- Base vertical: 0.4 blocks/tick (capped)
- Sprint multiplier: +1.0 (doubles knockback)
- Forward attack reduction: 0.6x (40% less KB when moving forward and attacking)
- Knockback resistance: Multiplies final velocity

### Netherite KB Resistance
Netherite armor adds knockback resistance. To nullify:
```java
AttributeInstance attr = player.getAttribute(Attribute.GENERIC_KNOCKBACK_RESISTANCE);
double current = attr.getValue();
attr.addModifier(new AttributeModifier(
    key, -current, AttributeModifier.Operation.ADD_NUMBER
));
```

### Sources
- [Minecraft Wiki - Knockback](https://minecraft.wiki/w/Knockback_(mechanic))
- [Hypixel Forums - KB Calculation](https://hypixel.net/threads/how-is-knockback-calculated.620638/)
- [OldCombatMechanics Issue #391](https://github.com/kernitus/BukkitOldCombatMechanics/issues/391)
- [LegacyKB Plugin](https://www.spigotmc.org/resources/legacykb-disable-netherite-knockback-resistance.86080/)

---

## 4. Sword Blocking

### Modern Implementation (1.21.2+)
Use the `consumable` component with `animation:block`:
```java
Consumable blocking = Consumable.consumable()
    .consumeSeconds(3600f)  // Effectively infinite
    .animation(ItemUseAnimation.BLOCK)
    .hasConsumeParticles(false)
    .build();
sword.setData(DataComponentTypes.CONSUMABLE, blocking);
```

### Detection
```java
boolean isBlocking = player.isHandRaised() &&
    player.getInventory().getItemInMainHand().getType().name().endsWith("_SWORD");
```

### Damage Reduction
Apply in EntityDamageEvent at HIGH priority:
```java
if (isBlocking(victim)) {
    event.setDamage(event.getDamage() * 0.5); // 50% reduction
}
```

### Sources
- [VanillaSwordBlocking Plugin](https://hangar.papermc.io/Player005/VanillaSwordBlocking)
- [Bring Back Blocking Plugin](https://www.spigotmc.org/resources/bring-back-blocking-1-8-sword-blocking-on-1-21.122223/)
- [OldCombatMechanics GitHub](https://github.com/kernitus/BukkitOldCombatMechanics)
- [Hypixel Forums - Snapshot 24w34a](https://hypixel.net/threads/24w34a-the-return-of-sword-blocking.5752115/)

---

## 5. Regeneration

### 1.8 Mechanics
- Regeneration rate: 1 HP every 80 ticks (4 seconds)
- Requires 18+ hunger (9 drumsticks)
- No saturation boost

### 1.9+ Mechanics
- With full hunger + saturation: 1 HP every 10 ticks (0.5 seconds)
- Saturation depletes during fast regen (1.5 saturation per HP)
- After saturation depletes: Same as 1.8

### Implementation
1. Cancel vanilla regen by tracking saturation
2. Run custom regen task every 80 ticks
3. Only heal if hunger >= 18

### Sources
- [Minecraft Wiki - Healing](https://minecraft.wiki/w/Healing)
- [Minecraft Wiki - Regeneration](https://minecraft.wiki/w/Regeneration)
- [SpigotMC - 1.8 Health Regen](https://www.spigotmc.org/threads/1-8-health-regeneration-in-1-9-1-10.175946/)

---

## 6. Critical Hits

### Requirements
**Both versions**:
- Must be falling (negative Y velocity)
- Not on ground
- Not in water/climbing/flying

**1.9+ Only** (bypass these for 1.8):
- Attack cooldown >= 84.8%
- Not sprint-knockback attacking

### Velocity Threshold
The falling threshold is approximately `-0.0784` (gravity constant). Any negative Y velocity works.

### Damage
Critical hits deal 150% damage (1.5x multiplier), applied before enchantments.

### Sources
- [Minecraft Wiki - Damage](https://minecraft.wiki/w/Damage)
- [Minecraft Wiki - Melee Attack](https://minecraft.wiki/w/Melee_attack)

---

## 7. Sweep Attack

### Disable via Attribute
```java
player.getAttribute(Attribute.PLAYER_SWEEPING_DAMAGE_RATIO).setBaseValue(0.0);
```

### Trigger Conditions
- Movement < 0.1 blocks/tick
- Attack cooldown >= 84.8%
- Affects entities within 3 blocks

### Sources
- [Paper Attribute API](https://jd.papermc.io/paper/1.21.5/org/bukkit/attribute/Attribute.html)
- [SpigotMC - Disable Sweep](https://www.spigotmc.org/threads/disable-sword-sweep-attack-ability.156252/)

---

## 8. Hitbox / Reach

### Attribute
```java
player.getAttribute(Attribute.PLAYER_ENTITY_INTERACTION_RANGE).setBaseValue(3.1);
```

### Default Values
- Survival: 3.0 blocks
- Creative: 5.0 blocks
- 1.8 had ~0.1 block margin

### Sources
- [Paper Attribute API](https://jd.papermc.io/paper/1.21.1/org/bukkit/attribute/Attribute.html)
- [Minecraft Wiki - Interaction Range](https://minecraft.wiki/w/Interaction_range)

---

## 9. Fishing Rod Knockback

### Key Finding
**Fishing rod knockback was NOT vanilla 1.8** - it was a Spigot bug that became a feature in PvP servers.

### Implementation
Listen for `PlayerFishEvent` with state `CAUGHT_ENTITY`:
```java
@EventHandler
public void onFish(PlayerFishEvent event) {
    if (event.getState() != PlayerFishEvent.State.CAUGHT_ENTITY) return;
    LivingEntity victim = (LivingEntity) event.getCaught();

    Vector direction = victim.getLocation().toVector()
        .subtract(event.getPlayer().getLocation().toVector())
        .normalize();

    Vector kb = direction.multiply(0.4);
    kb.setY(0.2);
    victim.setVelocity(victim.getVelocity().add(kb));
}
```

### Sources
- [SpigotMC - Fishing Rod Knockback Plugin](https://www.spigotmc.org/resources/1000-downloads-1-9-1-14-fishing-rod-knockback-was-return-support-configuration.62101/)
- [Minecraft Wiki - Fishing Rod](https://minecraft.wiki/w/Fishing_Rod)
- [Hypixel Forums - Rod PvP Guide](https://hypixel.net/threads/guide-the-basics-to-rod-pvp.4784659/)

---

## 10. Tool Damage (Axes)

### 1.8 vs 1.9 Damage Values

| Weapon | 1.8 Damage | 1.9+ Damage |
|--------|------------|-------------|
| Wood Axe | 4 | 7 |
| Stone Axe | 5 | 9 |
| Iron Axe | 6 | 9 |
| Diamond Axe | 7 | 9 |
| Diamond Sword | 8 | 7 |

### Implementation
Reduce axe damage in EntityDamageByEntityEvent:
```java
double reduction = switch(axeType) {
    case DIAMOND_AXE -> 2.0;  // 9 -> 7
    case IRON_AXE -> 3.0;     // 9 -> 6
    // etc.
};
event.setDamage(event.getDamage() - reduction);
```

### Sources
- [Minecraft Wiki - Axe](https://minecraft.wiki/w/Axe)
- [Minecraft Wiki - Damage](https://minecraft.fandom.com/wiki/Damage)
- [OldCombatMechanics Config](https://pastebin.com/VBqaH72E)

---

## 11. Strength Potion

### 1.8 (Multiplicative)
- Strength I: damage × 2.3 (+130%)
- Strength II: damage × 3.6 (+260%)
- Formula: `damage × (1 + 1.3 × (amplifier + 1))`

### 1.9+ (Flat/Additive)
- Strength I: +3 damage
- Strength II: +6 damage

### Implementation
```java
@EventHandler(priority = EventPriority.HIGH)
public void onDamage(EntityDamageByEntityEvent event) {
    LivingEntity attacker = (LivingEntity) event.getDamager();
    PotionEffect strength = attacker.getPotionEffect(PotionEffectType.STRENGTH);
    if (strength == null) return;

    int amp = strength.getAmplifier();
    double modernBonus = 3.0 * (amp + 1);
    double baseDamage = event.getDamage() - modernBonus;
    double multiplier = 1.0 + (1.3 * (amp + 1));
    event.setDamage(baseDamage * multiplier);
}
```

### Sources
- [Minecraft Wiki - Strength](https://minecraft.wiki/w/Strength)
- [Hypixel Forums - Strength Mechanics](https://hypixel.net/threads/how-does-strength-work.2158564/)

---

## 12. Attack Indicator

### Hiding Options
1. Set attack speed to 1024+ (indicator disappears when cooldown is instant)
2. Use ProtocolLib to intercept and cancel relevant packets
3. Player can disable in their own settings

### Sources
- [SpigotMC - Remove Attack Indicator](https://www.spigotmc.org/threads/any-way-to-remove-attack-indicator.676068/)
- [ProtocolLib](https://github.com/dmulloy2/ProtocolLib)

---

## 13. Projectile Knockback (Snowballs/Eggs)

### Key Finding
Snowball/egg knockback **is NOT vanilla** - it was a Spigot bug. Java Edition players don't receive knockback from snowballs in vanilla.

### Implementation
Listen for `ProjectileHitEvent`:
```java
@EventHandler
public void onHit(ProjectileHitEvent event) {
    if (!(event.getHitEntity() instanceof LivingEntity victim)) return;

    double kb = event.getEntity() instanceof Snowball ? 0.3 : 0.25;
    double kbY = event.getEntity() instanceof Snowball ? 0.15 : 0.1;

    Vector dir = victim.getLocation().toVector()
        .subtract(event.getEntity().getLocation().toVector())
        .normalize();
    dir.setY(0);

    Vector knockback = dir.multiply(kb);
    knockback.setY(kbY);
    victim.setVelocity(knockback);
}
```

### Sources
- [Minecraft Wiki - Snowball](https://minecraft.wiki/w/Snowball)
- [SpigotMC - Projectile Knockback](https://www.spigotmc.org/resources/projectile-knockback.59485/)
- [SpigotMC - Bug or Feature Discussion](https://www.spigotmc.org/threads/bug-or-feature-snowball-egg-knockback.214759/)

---

## 14. Hit Immunity (iFrames)

### Default Duration
10 ticks (0.5 seconds) of invulnerability after being hit.

### Behavior
- Only highest damage source registers
- Multiple hits on same tick = only highest applies
- Damage higher than previous hit = difference is dealt

### Sources
- [CurseForge - NoDamI Mod](https://www.curseforge.com/minecraft/mc-mods/nodami)
- [SpigotMC - NoDamageTicks](https://www.spigotmc.org/resources/nodamageticks.80396/)

---

## Critical Takeaways

### Paper 1.21.1 Limitations
1. **No DataComponentTypes API** - Can't modify consumable/food properties
2. **Must use workarounds** for golden apple eating speed

### Recommended Actions
1. **Upgrade to Paper 1.21.2+** for full API access
2. **Use FoodComponent** (deprecated but works) as fallback
3. **Consider NMS** for features not exposed via API

### Reference Plugins
- [OldCombatMechanics](https://github.com/kernitus/BukkitOldCombatMechanics) - Most comprehensive
- [VanillaSwordBlocking](https://hangar.papermc.io/Player005/VanillaSwordBlocking) - Sword blocking
- [LegacyKB](https://www.spigotmc.org/resources/legacykb-disable-netherite-knockback-resistance.86080/) - Netherite KB

---

## Source Count: 35+

All sources cited inline throughout this document.
